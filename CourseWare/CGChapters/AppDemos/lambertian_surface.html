<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>朗伯面(Lambertian)反射定律演示</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
        }

        .app-container {
            width: 90%;
            max-width: 600px;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }

        h1 {
            margin-top: 0;
            color: #1a237e;
        }

        canvas {
            background-color: #e8eaf6;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            margin: 10px auto;
        }

        .controls {
            margin-top: 20px;
        }

        .controls label {
            font-size: 1.1em;
            font-weight: bold;
            color: #3f51b5;
        }
        
        input[type="range"] {
            width: 80%;
            max-width: 400px;
            margin-left: 10px;
        }

        .readout {
            margin-top: 20px;
            font-size: 1.2em;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .readout strong {
            color: #d32f2f;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <h1>朗伯(Lambertian)反射定律</h1>
        <p>演示漫反射强度与入射光垂直分量的关系。</p>
        
        <canvas id="demoCanvas" width="500" height="350"></canvas>
        
        <div class="controls">
            <label for="angleSlider">调整入射角 (θ):</label>
            <input type="range" id="angleSlider" min="0" max="180" value="30">
        </div>

        <div class="readout">
            入射角 (θ): <strong id="angleDisplay">30°</strong><br>
            垂直分量 (cos(θ)): <strong id="cosDisplay">0.87</strong><br>
            反射光强度: <strong id="intensityDisplay">0.87</strong>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('demoCanvas');
        const ctx = canvas.getContext('2d');
        const slider = document.getElementById('angleSlider');
        const angleDisplay = document.getElementById('angleDisplay');
        const cosDisplay = document.getElementById('cosDisplay');
        const intensityDisplay = document.getElementById('intensityDisplay');

        // 定义绘图原点和向量长度
        const origin = { x: canvas.width / 2, y: 280 };
        const vecLength = 120; // 入射光向量的长度

        function draw() {
            // 1. 获取角度和计算强度
            const angleDeg = parseFloat(slider.value);
            const angleRad = angleDeg * Math.PI / 180;
            
            // 朗伯定律的核心
            const intensity = Math.cos(angleRad);
            const clampedIntensity = Math.max(0, intensity); // 强度不能为负

            // 2. 更新文本显示
            angleDisplay.textContent = `${angleDeg.toFixed(0)}°`;
            cosDisplay.textContent = `${clampedIntensity.toFixed(2)}`;
            intensityDisplay.textContent = `${clampedIntensity.toFixed(2)}`;

            // 3. 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 4. 绘制表面
            ctx.fillStyle = '#616161';
            ctx.fillRect(0, origin.y, canvas.width, 5);

            // 5. 绘制法线 (N)
            ctx.beginPath();
            ctx.setLineDash([5, 5]);
            ctx.moveTo(origin.x, origin.y);
            ctx.lineTo(origin.x, origin.y - vecLength - 30);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Inter';
            ctx.fillText('N (法线)', origin.x + 8, origin.y - vecLength - 15);

            // 6. 绘制入射光 (L)
            // L 的终点坐标
            const lightEndX = origin.x + vecLength * Math.sin(angleRad);
            const lightEndY = origin.y - vecLength * Math.cos(angleRad);
            
            ctx.beginPath();
            drawArrow(ctx, lightEndX, lightEndY, origin.x, origin.y, '#f57f17', 4); // 黄色箭头
            ctx.fillText('L (入射光)', lightEndX, lightEndY - 10);

            // 7. 绘制角度弧线 (θ)
            ctx.beginPath();
            ctx.arc(origin.x, origin.y, 40, -Math.PI / 2, -Math.PI / 2 + angleRad);
            ctx.strokeStyle = '#d32f2f';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = '#d32f2f';
            ctx.font = '16px Inter';
            ctx.fillText('θ', origin.x + 45 * Math.sin(angleRad / 2), origin.y - 45 * Math.cos(angleRad / 2));

            // 8. 绘制垂直分量 (核心)
            const projLength = vecLength * clampedIntensity;
            ctx.beginPath();
            ctx.moveTo(origin.x, origin.y);
            ctx.lineTo(origin.x, origin.y - projLength);
            ctx.strokeStyle = '#4caf50'; // 绿色
            ctx.lineWidth = 6;
            ctx.stroke();
            ctx.fillStyle = '#4caf50';
            ctx.fillText('垂直分量', origin.x - 100, origin.y - projLength / 2);

            // 9. 绘制漫反射 (蓝色半圆)
            ctx.beginPath();
            ctx.arc(origin.x, origin.y, 90, Math.PI, 0); // 半圆
            // 关键：反射强度与clampedIntensity绑定
            ctx.fillStyle = `rgba(33, 150, 243, ${clampedIntensity})`; 
            ctx.fill();
            ctx.fillStyle = '#1e88e5';
            ctx.fillText('漫反射', origin.x + 100, origin.y - 40);
        }

        // 绘制带箭头的线段
        function drawArrow(ctx, fromx, fromy, tox, toy, color, width) {
            const headlen = 10; // 箭头长度
            const dx = tox - fromx;
            const dy = toy - fromy;
            const angle = Math.atan2(dy, dx);
            
            ctx.beginPath();
            ctx.moveTo(fromx, fromy);
            ctx.lineTo(tox, toy);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.stroke();
            
            // 绘制箭头
            ctx.beginPath();
            ctx.moveTo(tox, toy);
            ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
            ctx.lineTo(tox, toy);
            ctx.fillStyle = color;
            ctx.fill();
        }

        // 事件监听
        slider.addEventListener('input', draw);

        // 初始绘制
        draw();
    </script>

</body>
</html>
