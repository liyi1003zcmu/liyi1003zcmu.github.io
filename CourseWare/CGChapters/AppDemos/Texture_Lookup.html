<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texture Lookup Simulator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better slider appearance */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db; /* gray-300 */
            border-radius: 9999px;
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #3b82f6; /* blue-500 */
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #3b82f6; /* blue-500 */
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans flex items-center justify-center min-h-screen p-4">

    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-4xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Texture Lookup Simulator</h1>
        <p class="text-center text-gray-600 mb-8">This demonstrates 'Nearest Neighbor' texture sampling. Move the sliders to change the (U, V) coordinates and see how the color is picked from the 'Texture Buffer'.</p>

        <!-- Main content area -->
        <div class="flex flex-col md:flex-row gap-8 items-center md:items-start justify-center">

            <!-- Left Side: Texture Buffer -->
            <div class="flex-shrink-0">
                <h2 class="text-xl font-semibold text-gray-700 mb-3 text-center">Texture Buffer (4x4)</h2>
                <div id="texture-grid" class="grid grid-cols-4 border-2 border-gray-400">
                    <!-- Grid cells will be added by JS -->
                </div>
            </div>

            <!-- Right Side: Fragment Output -->
            <div class="flex-shrink-0">
                <h2 class="text-xl font-semibold text-gray-700 mb-3 text-center">Fragment Output</h2>
                <div id="fragment-output" class="w-48 h-48 md:w-64 md:h-64 border-2 border-gray-400 bg-gray-200 transition-colors duration-100 shadow-inner rounded-lg"></div>
            </div>

        </div>

        <!-- Bottom Side: Sliders -->
        <div class="mt-10 max-w-lg mx-auto">
            <!-- U Coordinate Slider -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <label for="u-slider" class="text-lg font-medium text-gray-700">U Coordinate</label>
                    <span id="u-label" class="text-lg font-mono text-blue-600 bg-blue-50 px-3 py-1 rounded">0.50</span>
                </div>
                <input type="range" id="u-slider" min="0" max="1" value="0.5" step="0.01" class="w-full">
            </div>

            <!-- V Coordinate Slider -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label for="v-slider" class="text-lg font-medium text-gray-700">V Coordinate</label>
                    <span id="v-label" class="text-lg font-mono text-blue-600 bg-blue-50 px-3 py-1 rounded">0.50</span>
                </div>
                <input type="range" id="v-slider" min="0" max="1" value="0.5" step="0.01" class="w-full">
            </div>
        </div>

    </div>

    <script>
        // --- 1. Define the 4x4 Texture Colors ---
        // A 2D array [y_index][x_index]
        const textureColors = [
            ['#e63946', '#f1faee', '#a8dadc', '#457b9d'], // Row 0 (V = 0.0 - 0.25)
            ['#1d3557', '#8d99ae', '#edf2f4', '#d90429'], // Row 1 (V = 0.25 - 0.5)
            ['#2a9d8f', '#e9c46a', '#f4a261', '#e76f51'], // Row 2 (V = 0.5 - 0.75)
            ['#003049', '#669bbc', '#c1121f', '#fdf0d5']  // Row 3 (V = 0.75 - 1.0)
        ];

        // --- 2. Get References to DOM Elements ---
        const textureGrid = document.getElementById('texture-grid');
        const fragmentOutput = document.getElementById('fragment-output');
        const uSlider = document.getElementById('u-slider');
        const vSlider = document.getElementById('v-slider');
        const uLabel = document.getElementById('u-label');
        const vLabel = document.getElementById('v-label');

        let allGridCells = [];

        // --- 3. Populate the Texture Grid ---
        function createTextureGrid() {
            textureColors.forEach((row, y) => {
                let rowCells = [];
                row.forEach((color, x) => {
                    const cell = document.createElement('div');
                    cell.className = 'w-12 h-12 md:w-16 md:h-16 transition-all duration-200 border-gray-300 border';
                    cell.style.backgroundColor = color;
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    textureGrid.appendChild(cell);
                    rowCells.push(cell);
                });
                allGridCells.push(rowCells);
            });
        }

        // --- 4. Main Update Function ---
        function updateOutput() {
            // Get values from sliders
            const u = parseFloat(uSlider.value);
            const v = parseFloat(vSlider.value);

            // Calculate the texture grid index
            // Math.floor(U * 4) and Math.floor(V * 4)
            // We must clamp the index to 3 (e.g., if U is 1.0, 1.0 * 4 = 4, which is out of bounds)
            let x_index = Math.min(Math.floor(u * 4), 3);
            let y_index = Math.min(Math.floor(v * 4), 3);
            
            // Handle the 1.0 edge case which would still map to 4
            if (u === 1.0) x_index = 3;
            if (v === 1.0) y_index = 3;

            // Look up the color
            const selectedColor = textureColors[y_index][x_index];

            // Set the 'Fragment Output' square's color
            fragmentOutput.style.backgroundColor = selectedColor;

            // Update labels
            uLabel.textContent = u.toFixed(2);
            vLabel.textContent = v.toFixed(2);
            
            // Highlight the selected grid cell
            highlightCell(x_index, y_index);
        }
        
        // --- 5. Helper function to highlight the active cell ---
        function highlightCell(targetX, targetY) {
            allGridCells.forEach((row, y) => {
                row.forEach((cell, x) => {
                    if (x === targetX && y === targetY) {
                        cell.style.transform = 'scale(1.1)';
                        cell.style.zIndex = '10';
                        cell.style.boxShadow = '0 0 15px 5px rgba(0, 0, 0, 0.5)';
                    } else {
                        cell.style.transform = 'scale(1.0)';
                        cell.style.zIndex = '1';
                        cell.style.boxShadow = 'none';
                    }
                });
            });
        }

        // --- 6. Add Event Listeners ---
        uSlider.addEventListener('input', updateOutput);
        vSlider.addEventListener('input', updateOutput);

        // --- 7. Initial Setup ---
        createTextureGrid();
        updateOutput(); // Run once on load to set initial state

    </script>
</body>
</html>